{% extends "base.html" %}
{% block title %}Audit log – {{ request.state.klub_oznaka or 'Radio klub' }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item active"><i class="bi bi-journal-text me-1"></i>Audit log</li>
    </ol>
  </nav>
  <a href="/audit/izvoz" class="btn btn-outline-secondary btn-sm">
    <i class="bi bi-download me-1"></i>Izvozi v Excel
  </a>
</div>

<div class="card">
  <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center flex-wrap gap-2">
    <span><i class="bi bi-journal-text me-2"></i>Audit log
      {% if akcija %}<span class="badge bg-secondary ms-2">{{ akcija }}</span>{% endif %}
      <span class="text-white-50 small ms-2">(zadnjih 500 vnosov)</span>
    </span>
    <form method="get" class="d-flex gap-2 align-items-center mb-0">
      <select name="akcija" class="form-select form-select-sm" style="width:auto" onchange="this.form.submit()">
        <option value="">– Vse akcije –</option>
        {% for a in akcije %}
        <option value="{{ a }}" {% if a == akcija %}selected{% endif %}>{{ a }}</option>
        {% endfor %}
      </select>
      {% if akcija %}
      <a href="/audit" class="btn btn-sm btn-outline-light">
        <i class="bi bi-x"></i>
      </a>
      {% endif %}
    </form>
  </div>

  <div class="card-body p-0">
    <table class="table table-sm table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:160px">Čas</th>
          <th style="width:120px">Uporabnik</th>
          <th style="width:110px">IP</th>
          <th style="width:160px">Akcija</th>
          <th>Opis</th>
        </tr>
      </thead>
      <tbody>
        {% for v in vnosi %}
        <tr>
          <td class="text-nowrap small text-muted">
            {{ v.cas.strftime('%d. %m. %Y %H:%M:%S') if v.cas else '–' }}
          </td>
          <td>{{ v.uporabnik or '–' }}</td>
          <td class="small text-muted">{{ v.ip or '–' }}</td>
          <td>
            <span class="badge
              {% if 'fail' in v.akcija %}bg-danger
              {% elif v.akcija == 'login_ok' %}bg-success
              {% elif v.akcija == 'logout' %}bg-secondary
              {% elif 'izbrisan' in v.akcija %}bg-danger
              {% elif 'dodan' in v.akcija %}bg-primary
              {% elif 'urejen' in v.akcija %}bg-primary
              {% elif 'ogled' in v.akcija %}bg-info text-dark
              {% elif 'izvoz' in v.akcija %}bg-warning text-dark
              {% else %}bg-light text-dark{% endif %}">
              {{ v.akcija }}
            </span>
          </td>
          <td class="small">{{ v.opis or '' }}</td>
        </tr>
        {% endfor %}
        {% if not vnosi %}
        <tr>
          <td colspan="5" class="text-center text-muted py-4">
            <i class="bi bi-journal-x me-1"></i>Ni vnosov.
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
